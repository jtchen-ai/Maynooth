# L6 磁盘操作与调度 (Disk Operation and Scheduling)

* **硬盘驱动器概述 (Hard Disk Drive Overview)**
    * **历史与重要性**:
        * 作为一种磁性存储设备，几十年来一直是持久性数据存储的主要形式。
        * 由IBM于1956年推出。
        * 了解其内部工作原理对于理解其性能、可靠性和接口至关重要。
        * 文件系统技术也基于其行为特性。
    * **物理组件 (Physical Characteristics)**:
        * 主轴 (Spindle)
        * 磁盘/盘片 (Disks/Platters)
        * 读写头 (Slider and Head)
        * 执行器臂 (Actuator Arm)
        * 执行器 (Actuator) 与 执行器轴 (Actuator Axis)
        * I/O 连接器、电源连接器、跳线引脚
    * **工程发展 (Engineering Developments)**:
        * 更小的盘片直径提供了更好的刚性、更轻的重量和更低的功耗。
        * 虽然小盘片记录面积更小，但位密度技术的增长足以弥补这一点。
        * 更快的信令接口提高了传输速度。
    * **固态硬盘 (Solid State Drives - SSDs)**:
        * 作为硬盘的物理替代品，但访问是电气的而非机械的，使用浮栅晶体管技术进行非易失性存储。
        * 与硬盘相比，具有能源和性能优势，但价格更高，容量通常更小。
        * 操作系统从SSD启动可能更快，文件打开速度可能比标准HDD快20-40倍。

* **数据组织与性能 (Data Organisation & Performance)**
    * **磁道与扇区 (Tracks and Sectors)**:
        * 每个盘片的表面被组织成一组同心的磁性轨道，称为**磁道 (Tracks)**。
        * 每个磁道被划分为多个固定大小的块，称为**扇区 (Sectors)**。
        * 扇区/块是可被寻址、读取或写入磁盘的最小存储单元。
        * 扇区大小历史上为512字节，新的大容量驱动器中为4KB。
    * **扇区结构 (Sector Structure)**:
        * 每个扇区区域的内容包括扇区ID信息、状态码、同步位模式、数据（512或4k字节）、纠错码和扇区间隙。
        * 更大的扇区大小提高了格式化效率，但代价是增加了最小空间分配单位。
    * **簇 (Clusters)**:
        * 一些操作系统可能将相邻的扇区分组成**簇 (clusters)**。
        * 簇是文件在磁盘上可以占用的最小空间量。
    * **区域位记录 (Zoned Bit Recording - ZBR)**:
        * 外圈磁道比较内圈磁道拥有更大的记录材料面积。
        * 轨道根据其与中心的距离分组，外区用于存储比内区更多的扇区。
        * 如果旋转速度恒定，数据从外圈磁道的传输速度比内圈磁道快。
        * 由于驱动器是从外到内填充的，它在全新和空闲时表现出最佳性能。
    * **性能指标 (Performance Metrics)**:
        * **容量 (Capacity)**: 高度可靠的大容量廉价解决方案。
        * **数据速率 (Data Rate)**: 驱动器和系统之间的带宽，如SATA-3 (~6Gb/s)。
        * **平均延迟 (Average Latency)**: 访问一个扇区的时间，例如4ms-9ms。
        * **可靠性 (Reliability)**: 平均无故障时间 (Mean Time to Failure)。

* **磁盘调度算法 (Disk Scheduling Algorithms)**
    * **寻道时间 (Seek Time)**:
        * 访问磁盘块最慢的部分是物理上将磁头移动到正确的磁道，这被称为寻道时间。
        * 正确调度I/O请求可以通过减少磁头必须移动的平均距离来减少平均寻道时间。
        * **本地命令队列 (Native Command Queuing - NCQ)** 是SATA协议的扩展，允许硬盘驱动器内部优化接收到的读写命令的执行顺序。
    * **示例场景**: 磁道编号0-200，磁头当前在磁道53，队列中的请求为：98, 183, 37, 122, 14, 124, 65, 67。
    * **算法**:
        * **FCFS (First Come First Served)**: 按请求到达的顺序服务。磁头移动顺序：53 -> 98 -> 183 -> 37 -> 122 -> 14 -> 124 -> 65 -> 67。
        * **SSTF (Shortest Seek Time First)**:
            * 选择离当前磁头位置最近的请求。
            * 该算法偏爱磁盘中间区域的请求，可能导致外圈和内圈磁道的请求被饿死。
        * **SCAN (电梯算法)**:
            * 磁头向一个方向移动（例如，朝磁道号增加的方向），服务沿途的请求，直到到达磁盘末端，然后反转方向。
            * 移动顺序：53 -> 65 -> 67 -> 98 -> 122 -> 124 -> 183 -> 200 -> 37 -> 14。
        * **C-SCAN (Circular SCAN)**:
            * 磁头向一个方向扫描，到达末端后，快速返回到起始端，然后再次以相同的方向开始扫描。
            * 这使得每个磁道被磁头连续访问之间的时间相同。
        * **LOOK**:
            * 与SCAN相同，但磁头在转向前会检查当前方向上是否还有请求，而不是总是移动到磁盘的末端。
            * 移动顺序：53 -> 65 -> 67 -> 98 -> 122 -> 124 -> 183 -> 37 -> 14。
        * **C-LOOK**:
            * 与C-SCAN相同，但磁头在快速返回前会检查当前方向上是否还有请求，而不是总是移动到磁盘的末端。
            * 移动顺序：53 -> 65 -> 67 -> 98 -> 122 -> 124 -> 183 -> 14 -> 37。