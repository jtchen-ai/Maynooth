# CS253 知识点：存储与硬件保护

## 1. 硬盘驱动器（Hard Disk Drive - HDD）

### 物理结构（Physical Structure）

- 组件（Components）
  - 盘片（Platter）
  - 读写头（Head）
  - 马达（Motors）
  - 磁道（Track）
  - 扇区（Sector）
  - 柱面（Cylinder）：所有盘片上相同位置磁道的集合
- 读写头（Read/Write Head）
  - 硬盘中，读写头在盘片表面上方 “飞行”；软盘中，读写头接触盘面
  - 硬盘密封在外壳中，防止灰尘导致读写头 “撞击” 盘面
  - 读写原理基于法拉第定律，磁场变化在读写头线圈中感应出电压

### 数据编码（Data Coding）

- **作用**：需要一种方法从信号中恢复时钟
- 锁相环（Phase-Locked Loop - PLL）
  - 用于同步时钟和数据信号的设备
  - 调整输出频率，使输入频率差异为零
- 编码方案
  - **FM（Frequency Modulation）**：每个时间片有 1 或 2 个边缘（电平变化）
  - **MFM（Modified Frequency Modulation）**：转换次数减半，实现双倍密度
  - **RLL（Run Length Limited）**：平均比 MFM 好 40%

### 性能参数（Performance Parameters）

- **寻道时间（Seek Time）**：磁头移动到特定位置所需时间，通常为 12ms
- **延迟时间（Latency Time）**：PLL 等开始从磁道读取数据所需时间，通常为 8ms
- **访问时间（Access Time）**：从请求数据到接收数据的时间，通常为 20ms
- **传输速率（Transfer Rate）**：硬盘约 10Mbits/Sec，软盘约 1Mbit/sec

### 磁盘格式化与逻辑结构（Disk Formatting & Logical Structure）

- 扇区格式

  ：扇区包含 ID、位置信息、保存的数据和校验和信息

  - **校验和（Checksum）**：用于检查数据写入是否成功，出错时扇区标记为 “坏”，数据写入其他扇区

- 磁盘布局（Boot Disk Layout）

  - 引导记录（Boot record）
  - 文件分配表（File Allocation Table - FAT）
  - FAT 的副本
  - 根目录（Root directory）
  - 数据区（Data area）

### 文件分配表（File Allocation Table - FAT）

- **作用**：存储磁盘上每个簇（Cluster）的起始位置（磁道，扇区）
- **簇（Cluster）**：由多个扇区组合而成
- FAT16
  - 最多允许 2¹⁶=65,535 个簇
  - 每个簇最多包含 32,768 字节
  - 导致 2G 字节的驱动器大小限制（65,535×32,768 字节）
  - **磁盘分区（Disk Partitioning）**：超过 2GB 的硬盘可分割成多个逻辑驱动器（如 C:, D:, E:）
  - **空间浪费**：存储小文件需占用整个簇，造成空间浪费
- FAT32
  - 可以引用 2³² 个簇
  - 解决 FAT16 的空间浪费和大小限制问题
- **根目录条目（Root Directory Entry）**：为每个文件存储 32 字节数据，包括文件名、扩展名、属性、创建时间、起始簇号和文件大小
- 文件到簇的链接
  - 根目录标识文件的第一个簇
  - FAT 表中每个簇条目指向文件的下一个簇，形成链表至文件结束

### 接口与技术（Interfaces & Technologies）

- **磁盘控制器（Disk Controller）**：同步机械运动、解码数据并提供与 PC 总线接口的定制 IC
- EIDE / SCSI
  - **EIDE（Enhanced IDE）**：允许连接四个设备（硬盘、磁带、CD-ROM），硬盘可更大
  - **SCSI（Small Computer Systems Interface）**：允许将多个设备链接在一起
- RAID（Random Array of Inexpensive Disks）
  - **目的**：提高磁盘访问速度、可靠性，消除维修停机时间
  - **原理**：数据条带化分布在多个磁盘上，可并行读 / 写提高数据速率
  - **热插拔（Hot-swap）**：可在不丢失数据时移除和更换磁盘，丢失磁盘可从其他磁盘奇偶校验信息重建
  - RAID 级别
    - **Level 0**：条带化，无奇偶校验，提高速度但无数据完整性提升
    - **Level 1**：磁盘镜像，无条带化
    - **Level 3**：条带化，有一个专用奇偶校验盘
    - **Level 5**：数据和奇偶校验都条带化分布在所有磁盘上
    - **Level 10**：条带化数据，并且对磁盘进行镜像

## 2. CD-ROM

- 物理特性
  - 数据以单条螺旋轨道形式组织，共有 20,000 条磁道
  - 采用恒定线速度扫描（200-500RPM）
- 工作原理
  - 激光束射向光盘底部，光线从光盘表面反射到光电单元
  - 凹坑（Pit）和平面（Land）对光的反射不同，从而读取数据
- 容量
  - CD 容量为 680MB
  - DVD 单层容量为 4.7GB，双面双层容量为 17.0GB

## 3. 计算机系统操作与保护

### 系统启动与中断（System Startup & Interrupts）

- **启动（Bootstrap）**：初始化寄存器，并将操作系统内核（核心部分）加载到内存中
- 中断处理
  - 操作系统通过中断响应事件
  - 中断发生时，返回地址被压入堆栈
  - 程序查找向量表获取服务例程的地址
  - **8086 中断来源**：硬件（NMI, INTR）、软件（如 int 021h）和错误 / 故障（如除零）

### I/O 方法（I/O Methods）

- 同步 I/O（Synchronous）
  - CPU 在 I/O 操作开始后控制硬件，直到任务完成才将控制权返回给请求进程
  - 若 CPU 在 I/O 期间只是等待，则效率低下
- 异步 I/O（Asynchronous）
  - I/O 开始后，控制权立即返回给请求进程
  - 中断信号标志数据传输结束
  - 操作系统使用设备状态表检查硬件状态，每个设备可能有请求队列

### 硬件保护（Hardware Protection）

- **目的**：确保不正确的程序不干扰其他程序
- 双模式操作（Dual-Mode Operation）
  - **用户模式（User Mode）**：为用户运行代码
  - **监控模式（Monitor Mode）**：为操作系统运行代码，也称系统模式或超级用户模式
  - CPU 中有位设置当前模式
  - **特权指令（Privileged Instructions）**：可能损害其他程序的指令，仅在监控模式下可用
- I/O 保护
  - 所有 I/O 指令都是特权指令
  - 用户程序只能通过操作系统与硬件交互
- 内存保护
  - 必须保护中断向量表，因其包含在监控模式下运行的 OS 服务例程
  - ** 基址寄存器（Base register）**和**界限寄存器（Limit register）** 定义进程安全的内存地址范围
  - 访问范围外内存会触发陷阱，可能导致 “通用保护故障” 蓝屏错误
- CPU 保护
  - **定时器中断（Timer interrupt）** 定期触发（PC 上每秒 18.2 次），确保操作系统从失控程序中重获控制权
  - 定时器可用于进程间上下文切换（多任务），每个进程分配时间片（time-slice）

### 系统调用（System Call）

- **定义**：进程请求操作系统执行操作的方法
- 机制
  - 通常以陷阱形式出现，指向中断向量中特定位置
  - 控制权通过中断向量传递给 OS 中的服务例程，模式位设为监控模式
  - OS 验证参数，执行请求，然后将控制权返回给系统调用之后的指令