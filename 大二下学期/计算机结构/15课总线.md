

# CS253 体系结构 III - 第15讲：总线 

## 模块一：总线基础 (Bus Fundamentals)

### 1.1 总线的定义与分类

- 总线 (Bus)：是一组连接计算机不同组件的共享通信线路，以及使用这些线路的标准 1。

- 通信类型:

  - 系统内通信 (Intrasystem communication)：

    用于连接计算机内部的各种组件，通信距离小于一米 。这种连接方式通常通过大量并行的、被称为“总线”的数据线来实现 3。

  - 系统间通信 (Intersystem communication)：

    用于连接计算机与远程硬件 。

    这种通信通常通过串行链路完成，主要是出于成本和可靠性的考虑 。

### 1.2 互连结构 (Interconnection Structure)

- 专线总线结构 (Dedicated bus)

  ：仅连接两个设备 。

  - 示例：计算机与打印机之间的连接、。

- 共享总线结构 (Shared bus)

  ：在不同时间点上，让多个设备使用相同的数据路径 。

  - 示例：CPU、内存和I/O设备共同连接到一条总线上。

## 模块二：总线的构成 (Bus Components)

### 2.1 典型计算机总线

一个典型的计算机总线系统由以下部分组成 ：

- 地址总线 (Address Bus)：
  - 当计算机需要读/写内存或I/O设备时，地址总线负责指定要访问的具体位置 11。
  - 它是一个仅输出 (output only)的总线 。
- 数据总线 (Data Bus)：
  - 一个双向 (bi-directional)总线，负责在CPU和其他组件之间传送数据 。
- 控制总线 (Control Bus)：
  - 一组输入/输出线路，用于在读/写操作期间控制事件发生的顺序 。

## 模块三：总线操作问题与解决方案 (Bus Operation Issues & Solutions)

### 3.1 竞争 (Contention)

- 问题描述

  ：当两个或多个设备的输出端同时连接到总线上时，就会发生“竞争” 。

  - 单向总线（如地址总线）实现简单，CPU作为唯一的信号源，其他设备仅监控 。

  - 但双向总线（如数据总线）需要在两个方向上传输数据，例如CPU与内存之间的读写操作 

    。

- 潜在后果：

  - 最好的情况是导致总线上的数据变得模糊不清 。
  - 最坏的情况是可能永久性地损坏总线或相关设备 。

- CMOS电路中的竞争

  ：如果两个连接在一起的CMOS输出端电平不同（一个高一个低），会导致巨大的电流流过晶体管，从而引发故障 。

### 3.2 解决方案

- 电流吸收逻辑 (Current Sinking Logic)：

  - 通过这种设计，所有设备的输出实际上被“或”在了一起 21。
  - 即使发生竞争，电路中的电阻也会限制电流，从而避免损坏 。
  - 缺点：速度非常慢（因为没有主动拉高电平的机制），并且会浪费功率 。

- 三态逻辑 (Tri-State Logic)：

  - 三态设备引入了第二条控制线，用于将设备与总线断开。

  - 除了逻辑高和逻辑低两种状态外，它还有第三种状态——

    断开 (Disconnected) 或称高阻态 (High Impedance)。

  - 在这种状态下，设备的输出呈现非常高的输入阻抗，相当于从总线上物理断开，从而有效防止了竞争的发生 。

## 模块四：总线时序与仲裁 (Bus Timing & Arbitration)

### 4.1 总线时序 (Bus Timing)

- 基本原则：

  在任何一个时刻，总线上只能有一个设备发送数据（称为主设备, master），所有其他设备必须处于监听或忽略状态（称为从设备,slave） 。

- 总线是系统性能的一个潜在瓶颈。

- 同步总线 (Synchronous Bus)：

  - 包含一个时钟信号，主设备和从设备都依照这个时钟信号在预定的时间槽内传输数据 。
  - 优点：可以达到非常高的数据传输速率 。
  - 缺点：整个总线的速度受限于连接在上面的最慢的那个设备 。

- 异步总线 (Asynchronous Bus)：

  - 不包含时钟信号，每一次数据传输都伴随着一组控制信号来协调和排序 。
  - 这个过程有时被称为握手 (handshaking)。

### 4.2 总线仲裁 (Bus Arbitration)

- 目的：当多个设备希望在同一时间使用总线时，总线仲裁机制被用来避免冲突和竞争 34。

- 主要方法：

  - 菊链 (Daisy Chaining)：

    - 当有设备请求总线时（Request信号变高），如果总线不忙（Busy信号为低），控制器会发出一个

      授权 (Grant)信号 。

    - 这个授权信号会像链条一样从一个设备传递到下一个，直到到达发出请求的设备 。

    - 获得授权的设备会将Busy信号置高，然后开始在总线上放置数据 。

  - 轮询 (Polling)：

    - 控制器通过专门的轮询线循环检查每一个设备，看其是否需要使用总线 。

    - 一旦发现有请求的活动单元，便使其连接到数据线，并置高Busy信号 。

    - 优先级由轮询的顺序决定 

      。

  - 独立请求 (Independent Requesting）：

    - 每个设备都拥有自己独立的请求线 (Request)和授权线 (Grant)，直接连接到总线控制器 。
    - 优先级由总线控制单元集中控制 。
    - 缺点：系统复杂性高，因为每个设备都需要两根额外的控制线 

## 模块五：PC总线实例 (PC Bus Examples)

### 5.1 PC总线架构

PC内部通常包含多种总线，形成一个分层的体系结构，例如连接CPU、缓存和内存的高速系统总线，以及用于连接外设的PCI和ISA总线 44。



### 5.2 ISA总线 (Industry Standard Architecture)

- 发布于1984年，由于有大量外设支持，它在很长一段时间内都非常流行 。

- 最初是一个8位宽、运行在4.77MHz的总线 。

- 后来扩展为16位宽，8MHz 

  。

### 5.3 PCI总线 (Peripheral Component Interconnect)

- 发布于1993年，并迅速成为最流行的I/O总线 。
- 它是一个32位宽、运行在33MHz的总线 。
- 由PCI控制器负责管理总线仲裁和控制 。
- PCI标准也被用于实现即插即用 (Plug and Play)功能。